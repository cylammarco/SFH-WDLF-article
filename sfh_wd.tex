% mnras_template.tex 
%
% LaTeX template for creating an MNRAS paper
%
% v3.0 released 14 May 2015
% (version numbers match those of mnras.cls)
%
% Copyright (C) Royal Astronomical Society 2015
% Authors:
% Keith T. Smith (Royal Astronomical Society)

% Change log
%
% v3.0 May 2015
%    Renamed to match the new package name
%    Version number matches mnras.cls
%    A few minor tweaks to wording
% v1.0 September 2013
%    Beta testing only - never publicly released
%    First version: a simple (ish) template for creating an MNRAS paper

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Basic setup. Most papers should leave these options alone.
\documentclass[fleqn,usenatbib]{mnras}

% MNRAS is set in Times font. If you don't have this installed (most LaTeX
% installations will be fine) or prefer the old Computer Modern fonts, comment
% out the following line
\usepackage{newtxtext,newtxmath}
% Depending on your LaTeX fonts installation, you might get better results with one of these:
%\usepackage{mathptmx}
%\usepackage{txfonts}

% Use vector fonts, so it zooms properly in on-screen viewing software
% Don't change these lines unless you know what you are doing
\usepackage[T1]{fontenc}

% Allow "Thomas van Noord" and "Simon de Laguarde" and alike to be sorted by "N" and "L" etc. in the bibliography.
% Write the name in the bibliography as "\VAN{Noord}{Van}{van} Noord, Thomas"
\DeclareRobustCommand{\VAN}[3]{#2}
\let\VANthebibliography\thebibliography
\def\thebibliography{\DeclareRobustCommand{\VAN}[3]{##3}\VANthebibliography}


%%%%% AUTHORS - PLACE YOUR OWN PACKAGES HERE %%%%%

% Only include extra packages if you really need them. Common packages are:
\usepackage{graphicx}	% Including figure files
\usepackage{amsmath}	% Advanced maths commands
% \usepackage{amssymb}	% Extra maths symbols

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% AUTHORS - PLACE YOUR OWN COMMANDS HERE %%%%%
\usepackage{svg}

% Please keep new commands to a minimum, and use \newcommand not \def to avoid
% overwriting existing commands. Example:
%\newcommand{\pcm}{\,cm$^{-2}$}	% per cm-squared
\newcommand{\msun}{\mathcal{M}_{\sun}}
\newcommand{\orcid}[1]{\href{https://orcid.org/#1}{\includesvg[width=10pt]{orcid}}}

\newcommand{\dummyfig}[1]{
  \centering
  \fbox{
    \begin{minipage}[c][0.25\textheight][c]{\columnwidth}
      \centering{#1}
    \end{minipage}
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% TITLE PAGE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Title of the paper, and the short title which is used in the headers.
% Keep the title short and informative.
\title[Galactic SFH from Gaia GCNS WDLF]{A new method to retrieve the star formation history from a white dwarf luminosity function -- an application to the $Gaia$ catalogue of nearby stars}

% The list of authors, and the short list which is used in the headers.
% If you need two or more lines of authors, add an extra line using \newauthor
%\author[M. C. Lam et al.]{
%M. C. Lam$^{1\,\orcid{0000-0002-9347-2298}}$\thanks{Contact e-mail: \href{mailto:lam@mail.tau.ac.il}{lam@tau.ac.il}}
%\\
\author[M. C. Lam et al.]{
M. C. Lam$^{1}$\thanks{Contact e-mail: \href{mailto:lam@mail.tau.ac.il}{lam@tau.ac.il}}
\\
% List of institutions
$^{1}$School of Physics and Astronomy, Tel Aviv University, Tel Aviv, Israel 69978
}

% These dates will be filled out by the publisher
\date{Accepted XXX. Received YYY; in original form ZZZ}

% Enter the current year, for the copyright statements etc.
\pubyear{2022}

% Don't change these lines
\begin{document}
\label{firstpage}
\pagerange{\pageref{firstpage}--\pageref{lastpage}}
\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Abstract of the paper
\begin{abstract}
With the state-of-the-art Gaia astrometry, the number of confirmed white dwarfs
has reached a few hundred thousands. We have reached the era that small features
in the Galactic white dwarf luminosity function (WDLF) can be resolved. We
demonstration how we can apply Markov chain Monte Carlo sampling on a set of
pre-computed partial-WDLFs to derive the star formation history of their progenitor
stellar population.

\end{abstract}

% Select between one and six entries from the list of approved keywords.
% Don't make up new ones.
\begin{keywords}
keyword1 -- keyword2 -- keyword3
\end{keywords}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% BODY OF PAPER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
White dwarfs~(WDs) are the final stage of stellar evolution of main
sequence~(MS) stars with zero-age MS~(ZAMS) mass less than $8\msun$. Since this
mass range encompasses the vast majority of stars in the Galaxy, these
degenerate remnants are the most common final product of stellar evolution,
thus providing a good sample to study the history of stellar evolution and star
formation in the Galaxy. In this state, there is little nuclear burning to
replenish the energy they radiate away. As a consequence, the luminosity and
temperature decrease monotonically with time. The electron degenerate nature
means that a WD with a typical mass of $0.6\mathcal{M}_{\sun}$ has a similar
size to the Earth, giving rise to their high densities, low luminosities, and
large surface gravities.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The use of the white dwarf luminosity function~(WDLF) as a cosmochronometer was
first introduced by \citet{1959ApJ...129..243S}. Given the finite age of the
Galaxy, there is a minimum temperature below which no white dwarfs can reach in
a limited cooling time. This limit translates to an abrupt downturn in the WDLF
at faint magnitudes. Evidence of such behaviour was observed by
\citet{1979ApJ...233..226L}, however, it was not clear at the time whether it
was due to incompleteness in the observations or to some defect in the
theory~(e.g.,~\citealp{1984ApJ...282..615I}). A decade later,
\citet{1987ApJ...315L..77W} gathered concrete evidence for the downturn and
estimated the age\footnote{``Age'' refers to the total time since the oldest
WD progenitor arrived at the zero-age main sequence.} of the disc to be
$9.3 \pm 2.0$\,Gyr~(see also \citealt{1988ApJ...332..891L}). While most studies
focused on the Galactic discs~\citep{1989LNP...328...15L, 1992ApJ...386..539W,
1995LNP...443...24O, 1998ApJ...497..294L, 1999MNRAS.306..736K,
2012ApJS..199...29G, 2021A&A...649A...6G}, some worked with the stellar
halo~\citep{2006AJ....131..571H, 2011MNRAS.417...93R, 2017AJ....153...10M,
2019MNRAS.482..715L}. 
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Most WDs have similar broadband colour to main sequence stars, they cannot be
identified using photometry alone. They are found from UV-excess, large
proper motion and/or parallax. Because of the strongly peaked surface gravity
distribution of WDs, photometric fitting for their intrinsic properties
is possible by assuming a surface gravity. WDs fitted in such a way are useful
statistically provided that the sample is not strongly biased. This is
demonstrated in various studies comparing photometric and spectroscopic
solutions to calibrate the atmosphere
model~\citep{2019ApJ...871..169G, 2019ApJ...882..106G}, as well as from the
agreeing shapes of the WDLFs from spectroscopic and photometric samples. The
Gaia satellite provides parallactic measurements for over a billion point
sources~\citep{2021A&A...649A...1G, 2021AJ....161..147B} of which $359,000$
are high confidence WD candidates~\citep[][hereafter, GF21]{2021MNRAS.508.3877G}.
The availability of parallaxes allows much more accurate fitting, particularly
without knowing the surface gravity for the photometric sample. This has
completely  revolutionized the field of WD sciences. In the forthcoming decade,
the Simonyi Survey Telescope at the Vera C. Rubin Observatory will continue to
discover more WDs at fainter magnitudes, but only accompanied by proper
motion measurement at best. Furthermore, at those magnitudes, it is infeasible
to collect spectrum for most of them and thus studies will mostly rely on
photometric methods.

\section{White Dwarf Luminosity Function}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
WDLF is a common tool for deriving the age of a stellar population. A WDLF is
the number density of WD as a function of luminosity, it is an evolving
function with time. Its shape and normalisation are determined from only a few
parameters. \citet{1987ApJ...315L..77W} compared an observed WDLF derived from
the Luyten Half-Second~(LHS) catalogue with a theoretical WDLF to obtain an
estimate of the age of the Galaxy for the first time with this technique.
\citet{1990ApJ...352..605N} examined WDLFs with various SFH scenarios. They
showed that WDLF is a sensitive probe of the star formation history~(SFH) as
it shows signatures of irregularities in the SFH such as bursts and lulls.
\citet{2013MNRAS.434.1549R} took it further to address this inverse problem
mathematically and showed some success in recovering the SFH of the solar
neighbourhood when compared against SFH computed from other methods. By
decomposing the disks and halo components of the Milky Way, we can have an
independent view of the past star formation history revealed by only the
WD populations, where they are most useful in deriving the SFH of old
stellar populations~\citep{2011MNRAS.417...93R, 2017ASPC..509...25L}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The physical picture of getting a population of isolated WDs is
straightforward: the progenitor stars formed in their birth clusters
following a distribution of mass~($\mathcal{M}_i$) described by the initial
mass function~(IMF, $\phi$). Then, they spend their lifetime carrying out
nuclear burning~($t_{\mathrm{MS}}$), and the time they spend depends mainly
on their mass. Towards the end stage of stellar evolution, stars loses most
of the atmosphere, modelled by the initial-final mass relation~(IFMR,
$\zeta$). Once they have become WDs, all that is left is to know how long it
has been cooling~($t_{\mathrm{cool}}$) in order to reach the current
luminosity~($M_\mathrm{bol}$). Most of the computations to account for these
physical processes are coming from the interpolations of pre-computed lookup
tables. Particular care is needed to interpolate and integrate over the
model grids, because they are both susceptible to significant rounding
errors given the huge dynamic ranges the variables cover. For example, in
the case of a simple starburst of $\mathcal{O}(10^6)$\,yrs, it requires a
relative error tolerance of $10^{-10}$ in order to integrate properly for
an old population.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The integral for a WDLF when parameterised with bolometric magnitude (as
opposed to luminosity) can be written as

\begin{equation}
    n(M_{\mathrm{bol}}) = \int_{\mathcal{M}_l}^{\mathcal{M}_u}
        \tau(M_\mathrm{bol}, \mathcal{M}_f)
        \psi(T_0, M_\mathrm{bol}, \mathcal{M}_i, m, Z)
        \phi(\mathcal{M}_i) d\mathcal{M}_i
\end{equation}
where $n$ is the number density, $\tau$ is the inverse cooling rate, $\psi$ is
the relative star formation rate, $\phi$ is the initial mass function; and their
dependent variables: $M_\mathrm{bol}$ is the absolute bolometric
magnitude, $\mathcal{M}_f$ is the WD mass, $T_0$ is the look-back time, $\mathcal{M}_i$ is
the progenitor MS mass, $Z$ is the metallicity, $\mathcal{M}_l$ is the minimum
progenitor MS mass that could have singly evolved into a WD in the given time,
and $\mathcal{M}_u$ is the maximum progenitor MS mass.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The inverse cooling rate
\begin{equation}
    \tau(M_\mathrm{bol}, \mathcal{M}_f) = \dfrac{dt_{\mathrm{cool}}}{dM_\mathrm{bol}} \left( M_\mathrm{bol}, \mathcal{M}_f \right)
\end{equation}
is a quantity taken from the pre-computed grid of cooling models. 

The relative star formation rate is expressed as a function of look-back time,
\begin{align}
    &\psi(T_0, M_\mathrm{bol}, \mathcal{M}_i, \mathcal{M}_f, Z) =\\
    &\qquad\psi\left[T_0 - t_{\mathrm{cool}}\left(M_\mathrm{bol}, \mathcal{M}_f\right) - t_{\mathrm{MS}}\left(\mathcal{M}_i, Z\right)\right].
\end{align}
The absolute normalisation is not needed when the total stellar mass is coming
from observations; the theoretical WDLF only needs to multiply with a
constant (the total number density) to account for the normalisation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The IFMR takes a simple form of
\begin{equation}
    \mathcal{M}_f = \zeta(\mathcal{M}_i),
\end{equation}
although there is evidence that more metal-rich stars lose more
envelope~\citep{2007ApJ...671..761K}, there is insufficient empirical data
to derive an IFMR at metallicity much lower or higher than solar abundance.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
All the calculations in this work adopt the following models: the IMF is that of
\citet{2003PASP..115..763C}, MS lifetime and metallicity are those from
PARSEC's solar metallicity model~\citep{2012MNRAS.427..127B}; the IFMR is
from \citet{2008MNRAS.387.1693C} and the WD cooling models are from the
Montreal group's August 2020 version~\citep{2020ApJ...901...93B}\footnote{\url{http://www.astro.umontreal.ca/~bergeron/CoolingModels}}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Retrieving Star Formation History from a WD population}
\citet{1990ApJ...352..605N} was the pioneer in studying how the shape of
a WDLF is more sensitive to the time-dependency of the SFR than to the changes
in the IMF. They have attributed the broad bump at $M_{\mathrm{bol}} \approx 10$
to a recent burst of star formation happened at a look back time of 0.3\,Gyr.
After a long hiatus, \citet{2013MNRAS.434.1549R} adopted the Richardson-Lucy
deconvolution method to retrieve the SFH from a WDLF. Their ``image'' are the
two-dimensional histograms in the progenitor mass -- formation time plane and 
the WD mass -- luminosity plane. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Spectroscopic Volume Complete Sample}
\citet{2014ApJ...791...92T} reported the SFH using a 40\,pc spectroscopic sample
of WDs. They found two peaks of star formation at around a look-back time of
$\approx4.5$\,Gyr and at $\approx8.5$\,Gyr. \citet{2019ApJ...878L..11I}
uses accurate parallactic measurements in Gaia to study massive white dwarfs in
the solar neighbourhood as reported in \citet{2019Natur.565..202T} to study the
effect of crystallisation. They found two peaks in the SFH from these massive
WDs within the 100\,pc distance from us, one at $\approx2.5$\,Gyr and one at
$\approx7$\,Gyr.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Parametric SFH}
\citet{2019ApJ...887..148F} investigated the SFH using
CFIS~\citep{2017ApJ...848..128I} and Pan-STARRS\,1 3$\uppi$
survey~\citep{2016arXiv161205560C}. CFIS covers $10,000$\,deg$^2$ and
$5000$\,deg$^2$ of the northern sky in u and r-band photometry to a depth of
$24.2$ and $24.85$,AB\,mag, respectively. They fit the sample with a skewed
Gaussian distribution that identified a peak SFH at $\approx8$\,Gyr.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Mathematical Inversion}
With a mathematical inversion method, it is possible to retrieve the SFH of a
stellar population~\citep{2013MNRAS.434.1549R}. However, it is prone to amplify
noise into enhanced star formation~\citep{2014ApJ...791...92T}. This is due to
the large number of degenerate solutions that can yield the WDLF agree to
within the uncertainty. Some forms of explicit regularization are necessary
to ensure smoothness in the solution. For example, \citet{2013MNRAS.434.1549R}
defines a convergence criterion (section~\textsection 2.1.4)
as a $1\%$ change in the best fit $\chi^2$, beyond which they consider the
improvement as overfitting. They have recovered a SFH in good agreement 
with other works, including the peak at 0.3\,Gyr, and an enhanced star 
formation peaking at around 2\,Gyr, a lull at 6 \,Gyr and a broad strong star 
formation showing the combined thin and thick disks between 7 and 10\,Gyr.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Forward modelling of WDLFs}
Another option to work on a statistical sample is to match a theoretical
WDLF based on a guess input SFH. However, a direct implementation to derive a
non-parametric SFH is extremely computationally heavy. In view of this, we look
into various astronomomical fitting techniques and found that it is possible to
follow the mathematical construction of full spectrum fitting of galactic
spectra, and the use of partial CMD to derive the SFH of a stellar
population~\citep{2006A&A...459..783C}, to speed up the modelling significantly.
In both of these methods, they derive various physical properties, e.g.\ SFH and
metallicity, of the stellar populsation. In the case of WDLF inversion in this
work, SFH is the only independent variable (function).

Full spectrum fitting works by comparing the observed spectrum agianst a
combination of basis model spectra of a set of precomupted simple stellar
poulation. Because of the large possible number of degenerate solutions and
noise can significantly alter the solution, regularisation is necessary to
avoid errorenously amplified solutions. For example, pPXF implements an explicit
regularisation parameter, which can be interpreted as a convergence criteria as
in \citet{2013MNRAS.434.1549R}. Alternatively, a Markov chain Monte-Carlo method
can be used to mitigate ``overfitting'' (e.g.\ Prospector). This automatically
comes with the statistics of the solutions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Partial WDLFs}
In order to apply the fitting method to compute the SFH from WDLFs, we introduce
partial WDLF~(pWDLF). It is inspired by the partial CMD designed
in~\citep{2006A&A...459..783C}, we use these pWDLFs as basis models
for fitting. Similar to both of these methods, the word \textit{partial} 
refers to a view of the system over a small time range. In the context of this
work, a pWDLF corresponds to a WDLF from a stellar population with an intense
star formation at the given time and with no star formation before or after
that.

\citet{2008ApJ...682L.109I} noted that at $M_{\mathrm{bol}} < 13$, the shape of
a WDLF is almost independent of the star formation rate. This was agrued
against by R11, and from our set of pWDLFs that it is obvious their statement
only holds if the WD samples do not extend into magnitudes fainter than
$\approx14.5$\,mag and it does not apply to short bursts of star formations.
And we shall see in the next section that the peak magnitude of a pWDLF is the
determining feature.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{SFH from fitting pWDLFs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Model Fitting}
\label{sec:model_fitting}
The likelihood function to be maximized is essentially minimizing the $\chi^2$
between the observed and the reconstructed WDLFs weighted by the variance from
the observed WDLF:
\begin{equation}
\chi^2 = \left(n(M_\mathrm{bol}) - n_\mathrm{obs}\right)^2 / \sigma_n^2
\end{equation}
where $n(M_\mathrm{bol}$ is the reconstructed WDLF, $n_\mathrm{obs}$ is the
observed WDLF, and $\sigma_n$ is the standard deviation in $n_\mathrm{obs}$.
The weight to each pWDLF in reconstructing the WDLF is directly proportional to
the SFH, if the set of pWDLFs was computed using the same normalising factor
from the IMF and IFMR. This can be written as

\begin{equation}
    n(M_\mathrm{bol}) = \sum_i w_i \times n_i(t, M_\mathrm{bol})    
\end{equation}

where the $w_i$ is the weight function to the pWDLF $n_i$ with a burst of star
formation at time $t$.

When the function is properly smoothed and weighted, the parameterisation with
luminosity and magnitude should give identical results agreed to within
rounding errors coming from the interpolation over the model grid covering a
large dynamic range of values.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Test case - noiseless}

We demonstrate the performance of the use of pWDLF in two scenarios:
(i)~exponentially increasing star formation rates at five truncation ages, and
(ii)~two bursts where the broad and weak burst is fixed in time while the strong
narrow burst are superposed at five different ages, as well as one with all
these profiles combined. The bin size in both time (number of pWDLFs) and
magnitude (number of data points in a WDLF) are the set used in analyzing the
empirical Gaia EDR3 data~(see Section~\ref{sec:magnitude_bin_size}).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Exponentially increasing SFR with a truncation}
This set of unrealistic SFH is to test the capability of the MCMC method in
recovering slowly varying trends as well as rapidly truncated features in the SFH.
The five input SFHs have an exponentially increasing SFH peaked at a look back
time of $2$, $4$, $6$, $8$ and $10$\,Gyr, where the exponential constant is
$3$\,Gyr. We can see excellent agreement in the recovered SFH. Although, there
are some correlated errors at a few magnitude bins, most notably at around $6$,
$9$ and $>11$\,mag. All but two bins in the purple curve have discrepancies
within two standard deviations from the input values. 

\begin{figure}
  \includegraphics[width=\columnwidth]{figures/fig_01_exponential_decay_wdlf.png}
  \caption{The recovered SFH and reconstructed SFH of a set of mock stellar
  populations with exponentially increasing star formation rates. Each
  population has an exponential constant of 3\,Gyr, the SFHs were truncated at
  a look-back time of 2, 4, 6, 8, and 10\,Gyr.}
  \label{fig:exponential_sfh}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Multiple bursts}
This set of WDLFs is to demonstrate that the method can retrieve sharp and
broad features whether they are distinctly separated or directly on top of each
other. The last set which comprises of all five sharp peaks and the broad
feature shows that there is some correlated results that are not completely
accounted for at around $6-7$\,mag. This is coming from the fact that the
pWDLFs are very similar as the WDLFs evolve the slowest at these magnitudes as
is obvious from the green and red curves in Fig.~\ref{fig:bursts_sfh}. We plan
to address this issue in a future work~(see \ref{sec:conclusion}).

\begin{figure}
  \includegraphics[width=\columnwidth]{figures/fig_02_two_bursts_wdlf.png} 
  \caption{The recovered SFH and reconstructed SFH of a set of mock stellar
  populations with a dual-burst SFH, and the second set has an inverse profile
  of the first set.}
  \label{fig:bursts_sfh}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Application to the Early Gaia Data Release 3}
The Early Data Release 3~(EDR3) of Gaia relies on 34 months of observations, it
represents an improvement on all fronts over DR2, with parallax measurements
being now on average 20-30 per cent more accurate and proper motion measurements
twice as accurate as in the previous
DRs~\citep{2021A&A...649A...1G, 2021A&A...649A...2L}. The Gaia Catalogue of
Nearby Stars~(GCNS) contains 331\,312 objects within 100\,pc of the Sun, of
which 21\,848 are white dwarfs~\citep{2021A&A...649A...6G}. However, this sample
is not completeness corrected. The incompleteness is primarily at the brightest
and the faintest absolute magnitudes where the astrometric solutions are the
least reliable due their small number count intrinsic faintness. Furthermore,
bright WDs are rare, they are found only at larger distances, there are very
few of them in the local 100\,pc.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Magnitude bin size}
\label{sec:magnitude_bin_size}
Upon deriving an SFH from a WDLF, one of the most important unsolved problems
is ``How much information can we obtain?''. We address in this work how, as a
first step, to achieve the maximal sampling in the magnitude space to extract
as much information from a WDLF as possible while avoiding the amplification of
noise. Any attempt in retrieving a signal at finer intervals than the
resolution of the data is essentially amplifying random noise. From the
uncertainties in the photometric fitting for the bolometric magnitudes, we can
determine the precision with which we can sample the WDLF. At the Nyquist
sampling rate~\citep{1949IEEEP..37...10S}, there should be two sampling points
in the space of one full-width at half maximum~(FWHM). Assuming the noise is
Gaussian, one FWHM is equivalent to $2.355$ standard deviations ($\sigma$).
Thus, the optimal sampling rate is $1.1775\sigma$ at the given magnitude.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Isolated WDs follow a narrow distribution of surface gravity with
$\log(g)=7.998 \pm 0.011$ for DA~\citep{2021MNRAS.507.4646K}. However, the
information blurring in the magnitude is not primarily affected by the accuracy
in fitting the WD surface gravity, rather, it is limited by the assumption of a
fixed surface gravity for the entire population of WDs. In other words, the
uncertainty in the bolometric magnitude estimated from the minimisation
function or an MCMC walk is not corresponding to the dispersion of the
smoothing kernel. Instead, we are interested in finding how much information
is smoothed and lost due to various approximations and assumptions.
\citet{2014ApJ...796..128G} reported that photometric fitting leads to a
dispersion of $\sigma_{\mathrm{log}_{g}} = 0.404$ in the $\log(g)$, which is
the combined effect of the intrinsic dispersion and the precision. The
synthetic photometry also comes with uncertainties, we estimate the model
uncertainty using the FWHM of the residuals in the SDSS filters reported in
\citet{2006AJ....132.1221H}. We take the mean FWHM of in $u$, $g$ and $r$ as
the proxy of -$G_{BP}$; the mean of $u$, $g$, $r$, $i$ and $z$ as a proxy of
$G$; and the mean of $r$, $i$ and $z$ as the proxy of $G_{RP}$. Dividing them
by $2.355$ gives us the dispersion that is added to the Gaia magnitude
uncertainty in quadrature. These values are found to be
$\sigma_{G_{BP}}=0.0529$, $\sigma_{G}=0.0462$ and $\sigma{G_{RP}}=0.0343$\,mag.
We refitted the entire GCNS WD samples at seven surface gravities to obtain
the estimates of the uncertainties in the fitted bolometric magnitudes due to
the assumption of fixed surface gravity. These seven values range from
$\log(g) - 3\sigma_{\mathrm{log}_{g}}$ to $\log(g) + 3\sigma_{\mathrm{log}_{g}}$
in an increment of one $\sigma_{\mathrm{log}_{g}}$. From the seven fitted
bolometric magnitudes, we can approximate the dispersion with:
\begin{equation}
  \sigma_{M_{\mathrm{bol}}} = \sum_{i} M_{\mathrm{bol}}(i\sigma_{\mathrm{log}_{g}}) / i - M_{\mathrm{bol}, 0}
\end{equation}
where the $0$ denotes the unperturbed surface gravity at $7.998$.

The Gaussian smoothing kernel is described by the sum of the fitting
uncertainties, the model uncertainties and the distribution coming from the
assumption of fixed surface gravity in quadrature~(blue scattered points in top
panel of Fig.~\ref{fig:magnitude_resolution}). The weighted average uncertainty
as a function of the bolometric magnitude is computed using the inverse maximum
volume as weights as it is used to weight each data point to the WDLF\footnote{
the bin centres of the bolometric magnitude used to compute the average are
1.5,  2.5,  3.5,  4.5,  5.25,  5.75,  6.25,  6.625, 6.85 to 17.25 in increment
of 0.2 and the last bin is centred at 17.475}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The use of WDLF relies on the assumption that WD share similar properties
at the same luminosity. Based on such an underlying assumption, we measure
the mean of these dispersions weighted by the $1/\mathrm{V}_{\mathrm{max}}$
as provided in the GCNS WD catalogue. Then they are fitted with a spline as
a function of bolometric magnitudes~(see Fig.~\ref{fig:magnitude_resolution}
and Table X in the appendix to reconstruct the spline) to get the average 
uncertainty as a function of the bolometric magnitude.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The WDLFs with short burst of star formation are strongly peaked at a single
magnitude (see, for example, the set of pWDLFs in Fig.~\ref{fig:basis_pwdlf}).
Thus, adding the monotonically cooling nature of WDs, there is a one-to-one
mapping of the age of the pouluation and the peak magnitude (see middle panel
of Fig.~\ref{fig:magnitude_resolution}. Although at older ages, with the peak
magnitude beyond $15$\,mag, a WDLF starts to show double peaks, there is always
a dominant peak that is at least half an order of magnitude highest in the
number density. Thus, we can reliably relate the two relations: peak
magnitude--age and peak magnitude--magnitude-resolution. Where the magnitude
has a one-to-one mapping to the age of the system, we can obtain the time
resolution in which we construct the set of the basis pWDLFs that would allow
the extraction the SFH at the maximum sampling rate without the amplification
of noise.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
At the oldest age~(i.e.\ faintest magnitudes), the uncertainties of the
bolometric magnitude is most likely underestimated as the value
$\sigma_{\mathrm{log}_{g}} = 0.404$ from \citet{2014ApJ...796..128G} did not
include WDs from the faint end. Additionally, from the recent calibration
works~(Bergeron), it is known that the models are less accurate at the lowest 
temperature, and the bolometric magnitudes obtained by assuming DA or DB
atmosphere are fainter than what mixed hydrogen-helium models would
give~\citep{2022ApJ...934...36B}. However, we cannot quantify these uncertainties
so we only caution readers to pay attention is drawing conclusions from any
information fainter than $\approx15.5$\,mag, which corresponds to a look back
time of $\approx9$\,Gyr.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}
    \includegraphics[width=\columnwidth]{figures/fig_03_mbol_sigma_magnitude_resoltuion.png}
    \caption{Top: the total uncertainties in the bolometric magnitude as a 
    function of bolometric magnitude~(blue). The moving median using the binning
    as described in Table~\ref{tab:magnitude_uncertainties} Due to the small
    number of data points, the weighted average at magnitudes fainter than
    $16.5$\,mag are not computed. At these magnitudes, the uncertainties at the
    last bin centred at $16.45$\,mag is used. Middle: the bolometric magnitude
    at which the peaks of the pWDLF are located. Bottom: the bolometric
    magnitude resolution of the WDLF computed using the fitting uncertainties
    from the top figure and the added uncertainties coming from the synthetic
    photometry and the assumption of fixed surface gravity~(see text).
    }
    \label{fig:magnitude_resolution}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}
    \includegraphics[width=\columnwidth]{figures/fig_04_basis_pwdlf.png}
    \caption{The set of partial WDLF (basis functions) that the peaks are
    separated by the magnitude resolution as found in
    Fig~\ref{fig:magnitude_resolution}. At older ages, double peaks start to
    emerge. However, there is always a dominant peak that is at least half an
    order of magnitude higher in the contribution.}
    \label{fig:basis_pwdlf}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Star Formation History}

By applying the set of basis function to the fitting method as described in
section \textsection\ref{sec:model_fitting}. Because the set of pWDLFs is
normalised the same way, the relative contribution directly translates to the
relative SFH of the solar neighbourhood. The absolute normalisation can be
found by matching the reconstructed WDLF to the integrated number density of
the input WDLF. We have found multiple phases of enhanced star formation using
this novel method, these bursts and lulls are all in good agreement with
previous works found using other methods and stellar popluations~(see next
section). As already pointed out in the previous section, we caution readers to
pay particular attention in drawing conclusions for any information older than
$\approx9$\,Gyr.

\begin{figure*}
    \includegraphics[width=\textwidth]{figures/fig_05_gcns_reconstructed_wdlf_optimal_resolution_bin_optimal.png}
    \caption{Top: The weights of the pWDLFs found from MCMC sampling finished
    with a least-squares minimisation. The x-axis on the top side shows only
    the cooling age WDs but not the total age. A luminosity function has
    marginalised over the progenitor masses, so the total age of WDs is not
    linearly mapped to this figure. Bottom: the reconstructed WDLF using the
    pWDLFs, the set of solutions refined with a least square method shows
    marginal improvement.}
    \label{fig:sfh_mag_bin_05}
\end{figure*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Comparison and discussion}
\subsection{WDLF}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\citet{2013MNRAS.434.1549R}

\citet{2019ApJ...878L..11I} is included as it is a good option of lower bound
of the number density.

\subsection{Other methods using WDs}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\citet{2014ApJ...791...92T}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\citet{2019ApJ...887..148F} computed the SFH from a deep proper motion survey,
however, their sample is only corrected for photometric incompleteness. The
untreated kinematic bias can lead to incompleteness in the sample
selection~\citep{2014ApJ...791...92T, 2015MNRAS.450.4098L}. Nevertheless, this
bias is unlikely to have a large impact on the thin disk population, yet in
their recovered SFH, a nearly-constant SFH was found. It brings up two immediate
questions: (1) is the recent burst that is seen in a few other works direction-
dependent? and (2) does the recent burst attributed to any major streaming that
they occupy a different part of the velocity space? These are important
questions to be addressed in future works.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\citet{2023MNRAS.522.1643C} found a constant star formation rate over the last
10.5\,Gyr with the 40\.pc sample of WDs. Their recovery method overlooks
information and sampling theory~\citep{1949IEEEP..37...10S} in extracting
information from a given signal~(WDLF). In observation astronomy, using
photometry as an example, optimal extraction based on a known point-spread
function is a technique to maximise the signal-to-noise ratio in the 
photometry~\citep{1980SPIE..264..171T, 1987PASP...99..191S}.
It is possible because we have information on how a point appears on the
detector plane after going through the optical system from the telescope
mirror~(or even to model the Earth's atmosphere if adaptive optics is used) to
the detector plane. Very similar reasoning is used in, and not limited to,
image differencing~\citep{1998ApJ...503..325A, 2008MNRAS.386L..77B,
2009MNRAS.397.2099A, 2016ApJ...830...27Z},
spectroscopy~\citep{1986PASP...98..609H, 1989PASP..101.1032M,
2003PASP..115..688K}, image reconstruction~\citep{1972JOSA...62...55R,
1974AJ.....79..745L}, image deconfusion~\citep{2015A&A...582A..15M}.
Furthermore, the uncertainties in a cumulative distribution function are not
merely the uncertainty in that given bin, the uncertainties accumulate to the
successive bin(s) non-linearly, depending on how accurate the measurement can
be made on the observed variable, in this case, the absolute magnitude in the
$G$ band.


\subsection{MS stars}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\citet{2006A&A...459..783C}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\citet{2007ApJ...665..767R} used the Hipparcos catalogue to calibrate
bias in the \citep{2005ApJS..159..141V} volume-limited spectroscopic
sample of 1039 FGK dwarfs in the solar neighbourhood with estimates of
their age and metallicity.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\citet{2019A&A...624L...1M}

\subsection{Subgiants}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\citet{2022Natur.603..599X}


\begin{figure}
  \dummyfig{Comparison} 
  \caption{Compared against previous works. red hue dashed lines show the SFH
  based on WD. blue hur dotted lines show the SFH found using other stellar
  populations.}
  \label{fig:dummy3}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions and Future Work}
\label{sec:conclusion}
By properly propagating the uncertainties in the
systematics and measurements, this work has shown that it is
possible to recover the star formation history with meaningful
uncertainties that encompass the uncertainties in the WD atmosphere
models, the photometry and the consequence of assuming a fixed
surface gravity in the detemination of the bolometric magnitude.
Using the bin sizes that are representative of the data given the
known effect of how the uncertainties limit the resolution of
the signal, we have chosen a set of varying bin sizes such that
it matches the Nyquist sampling rate where two sampling points are
required for every FWHM. It is obvious from our careful treatment
of uncertainties, along with the comparison from all other
works, that with the currently available surveys and computing
facilities, we can retrieve complex signal from the given noisy
data using well established mathematical tools and good knowledge
of the optical system.

\subsection{Known issues}
\begin{itemize}
    \item The GCNS sample is not incompleteness corrected, particularly, the
    kinematic selection can lead to a significant 
    bias~\citep{2015MNRAS.450.4098L}. And how the parallax-related selection,
    for example, the Lutz-Kelker bias~\citep{1973PASP...85..573L} would affect
    the shape of the WDLF, hence the SFH.
    \item The model uncertainty in the synthetic photometry is considered,
    however, the treatment is not rigorous as the uncertainty should be as
    a function of the bolometric magnitude. Particularly, it is known that
    in the visible wavelengths, the errors are the largest at the coolest end.
    \item The choice of cooling models, initial-final mass relation and
    synthetic photometric models have impacts on the WDLFs, hence the SFH.
    \item The effect of WD atmosphere types, the progenitor binary fraction,
    and the unresolved binary WDs are not taken into account.
    \item
    \item
    \item
    \item
\end{itemize}


All the derivation of SFH from WDLFs of the solar neighbourhood were reported
in the bolometric magnitudes. Thus, all works essentially made use of The
WD-bolometric-LF. To address the problem of degeneracy and correlated signal
in the solution, we will explore the use of colours, where we simultaneously
fit multiple WDLFs~(in multiple filters) as we note that the pWDLFs evolve
differently in different filters.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Acknowledgements}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Data Availability}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% REFERENCES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% The best way to enter references is to use BibTeX:

\bibliographystyle{mnras}
\bibliography{sfh_wd} % if your bibtex file is called example.bib


% Alternatively you could enter them by hand, like this:
% This method is tedious and prone to error if you have lots of references
%\begin{thebibliography}{99}
%\bibitem[\protect\citeauthoryear{Author}{2012}]{Author2012}
%Author A.~N., 2013, Journal of Improbable Astronomy, 1, 1
%\bibitem[\protect\citeauthoryear{Others}{2013}]{Others2013}
%Others S., 2012, Journal of Interesting Stuff, 17, 198
%\end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% APPENDICES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Tabulated data for the bolometric magnitude resolution}
\begin{table}
    \centering
    \begin{tabular}{c|c}
        Magnitude / mag & Magnitude resolution / mag \\\hline\hline
        5.7983 & 3.1967\\
        8.1014 & 1.4094\\
        9.3663 & 1.1204\\
        10.4145 & 0.9759\\
        11.3062 & 0.8077\\
        12.0220 & 0.6238\\
        12.5581 & 0.4485\\
        12.9453 & 0.3258\\
        13.2311 & 0.2457\\
        13.4506 & 0.1935\\\hline
        13.6251 & 0.1554\\
        13.7680 & 0.1305\\
        13.8905 & 0.1146\\
        13.9983 & 0.1010\\
        14.0934 & 0.0892\\
        14.1793 & 0.0826\\
        14.2605 & 0.0799\\
        14.3388 & 0.0767\\
        14.4137 & 0.0731\\
        14.4873 & 0.0742\\\hline
        14.5621 & 0.0754\\
        14.6385 & 0.0774\\
        14.7177 & 0.0811\\
        14.8009 & 0.0852\\
        14.8885 & 0.0899\\
        14.9809 & 0.0950\\
        15.0784 & 0.0999\\
        15.1809 & 0.1051\\
        15.2893 & 0.1117\\
        15.4018 & 0.1133\\\hline
        15.5162 & 0.1154\\
        15.6323 & 0.1169\\
        15.7504 & 0.1193\\
        15.8719 & 0.1236\\
        15.9967 & 0.1261\\
        16.1279 & 0.1362\\
        16.2730 & 0.1541\\
        16.4294 & 0.1587\\
        16.5881 & 0.1587\\
        16.7468 & 0.1587\\\hline
        16.9055 & 0.1587\\
        17.0642 & 0.1587\\
        17.2229 & 0.1587\\
        17.3816 & 0.1587\\
        17.5403 & 0.1587\\
        17.6990 & 0.1587\\
        17.8577 & 0.1587\\
        18.0164 & 0.1587\\
        18.1750 & 0.1587\\
        18.3337 & 0.1587\\\hline
        18.4924 & 0.1587\\
        18.6511 & 0.1587\\
        18.8098 & 0.1587\\
        18.9685 & 0.1587\\
        19.1272 & 0.1587\\
        19.2859 & 0.1587\\
        19.4446 & 0.1587\\
        19.6033 & 0.1587\\
        19.7620 & 0.1587\\
        19.9207 & 0.1587\\\hline
            \end{tabular}
    \caption{The bin centre and bin size used in the analysis. The bin sizes are
    already multiplied by the factor of 1.1775.}
    \label{tab:magnitude_resolution}
\end{table}


% Don't change these lines
\bsp	% typesetting comment
\label{lastpage}
\end{document}

% End of mnras_template.tex
